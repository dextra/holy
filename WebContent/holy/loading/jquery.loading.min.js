(function($){jQuery.pushLoading=function(opts){if(!$(".loading").length){$("body").append('<div class="loading"><div class="load"></div><div class="overlay"></div></div>')}var stack=$(".loading").data("loading-ajax-stack");if(!stack){stack=0}if(stack<0){throw"error: stack < 0: "+stack}stack++;if(stack==1){$(".loading .load").center();$(".loading").show()}$(".loading").data("loading-ajax-stack",stack)};jQuery.popLoading=function(opts){if(!$(".loading").length){throw"dom .loading not found"}var stack=$(".loading").data("loading-ajax-stack");if(!stack||stack<0){throw"error: stack <= 0: "+stack}if(stack==1){$(".loading").hide()}stack--;$(".loading").data("loading-ajax-stack",stack)};jQuery.loading=function(opts){var bgOver=opts.overlay;if(!bgOver){bgOver="#000000"}var overOpacity=opts.opacity;if(!overOpacity){overOpacity="50"}$("body").ajaxSend(function(evt,xhr,ajax){if(!ajax.loading){return}if(ajax.loading===true){$.pushLoading();return}$(ajax.loading).each(function(){var stack=$(this).data("loading-ajax-stack");if(!stack){stack=0}if(stack<0){throw"error: stack < 0: "+stack}stack++;if(stack==1){var div=$('<div class="loading"><div class="load"></div><div class="overlayInside"></div></div>');div.css("position","absolute");div.css("left",$(this).position().left);div.css("top",$(this).position().top);div.css("width",$(this).width());div.css("height",$(this).height());$("body").append(div);$(this).data("loading-ajax",div)}$(this).data("loading-ajax-stack",stack)})});$("body").ajaxComplete(function(evt,xhr,ajax){if(!ajax.loading){return}if(ajax.loading===true){$.popLoading();return}$(ajax.loading).each(function(){var stack=$(this).data("loading-ajax-stack");if(!stack||stack<=0){throw"error: !stack || stack <= 0: "+stack}if(stack==1){var div=$(this).data("loading-ajax");$(this).data("loading-ajax",null);$(this).data("loading-ajax-stack",0);div.remove()}else{stack--;$(this).data("loading-ajax-stack",stack)}})})}})(jQuery);